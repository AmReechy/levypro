{% extends "base.html" %}
{% block title %}Payee Lookup{% endblock %}

{% block content %}
<div class="space-y-8">

    <!-- Search Box -->
    <div class="bg-white p-6 rounded-lg shadow relative">
				<span class="absolute -top-1 -translate-y-full right-0 inline-block px-2 py-1 bg-white shadow"><a href="{% url 'dashboard' %}" class="underline underline-offset-2 text-sm font-medium text-green-700">Back to Dashboard</a></span>
        <h2 class="text-lg font-semibold mb-4">Find Payee</h2>

        <form method="get" class="flex flex-col md:flex-row gap-3">
            <input
                type="text"
                name="id_number"
                value="{{ searched_id }}"
                placeholder="Enter Payee ID Number"
                required
                class="flex-1 px-3 py-2 border rounded focus:ring focus:ring-blue-200"
            >
            <button
                type="submit"
                class="bg-green-700 hover:bg-green-800 text-white px-6 py-2 rounded"
            >
                Search
            </button>
        </form>

        {% for message in messages %}
            <p class="mt-3 text-sm text-red-600">{{ message }}</p>
        {% endfor %}
    </div>

    {% if payee %}

    <!-- Biodata -->
    <div class="bg-white p-6 rounded-lg shadow">
        <h3 class="text-lg font-semibold mb-4">Payee Information</h3>

        {% if payee.passport_photo %}
        <div class="flex justify-center my-6">
            <img
                src="{{ payee.passport_photo.url }}"
                alt="Payee Passport"
                class="w-56 h-56 border rounded-full"
            >
        </div>
        {% endif %}

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
            <p><strong>Name:</strong> {{ payee.full_name }}</p>
            <p><strong>ID:</strong> {{ payee.id_number }}</p>
            <p><strong>Email:</strong> {{ payee.email }}</p>
            <p><strong>Phone:</strong> {{ payee.phone_number }}</p>
            <p><strong>Location:</strong> {{ payee.location }}</p>
            <p><strong>Occupation:</strong> {{ payee.occupation }}</p>
            <p><strong>Address:</strong> {{ payee.address }}</p>
            <p>
                <strong>Applicable Levies:</strong>
                {% for l in payee.levy_types.all %}
                    {{ l.name }}{% if not forloop.last %} | {% endif %}
                {% endfor %}
            </p>
        </div>
    </div>

    <!-- Payment History -->
    <div class="bg-white p-6 rounded-lg shadow overflow-x-auto">
        <h3 class="text-lg font-semibold mb-4">Payment History</h3>

        {% if payments %}
        <table class="w-full text-sm border">
            <thead class="bg-gray-100">
                <tr>
                    <th class="p-2 border">Levy Type</th>
                    <th class="p-2 border">Amount</th>
                    <th class="p-2 border">Month</th>
                    <th class="p-2 border">Date Paid</th>
                    <th class="p-2 border">Receipt</th>
                </tr>
            </thead>
            <tbody>
                {% for payment in payments %}
                <tr class="text-center">
                    <td class="p-2 border">{{ payment.levy.name }}</td>
                    <td class="p-2 border">â‚¦{{ payment.amount }}</td>
                    <td class="p-2 border">{{ payment.month|date:"F Y" }}</td>
                    <td class="p-2 border">{{ payment.paid_at|date:"Y-m-d" }}</td>
                    <td class="p-2 border">
                        <a
                            href="{% url 'view_receipt' payment.receipt.id %}"
                            class="text-blue-600 underline"
                        >
                            View
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
            <p class="text-sm text-gray-500">No payments recorded.</p>
        {% endif %}
    </div>

    <!-- Outstanding Levies (View-only) -->
    <div class="bg-white rounded-lg shadow p-6">
        <h3 class="text-lg font-semibold mb-4">Outstanding Levies</h3>

        {% if outstanding_levies %}
        <table class="w-full text-sm">
            <thead class="bg-gray-100">
                <tr>
                    <th class="px-4 py-2">Levy</th>
                    <th class="px-4 py-2">Month</th>
                    <th class="px-4 py-2">Amount</th>
                    <th class="px-4 py-2">Status</th>
                </tr>
            </thead>
            <tbody>
                {% for item in outstanding_levies %}
                <tr class="border-b">
                    <td class="px-4 py-2">{{ item.levy_name }}</td>
                    <td class="px-4 py-2">{{ item.month|date:"F Y" }}</td>
                    <td class="px-4 py-2">â‚¦{{ item.amount }}</td>
                    <td class="px-4 py-2">
                        <span class="px-2 py-1 text-xs rounded bg-red-100 text-red-700">
                            Unpaid
                        </span>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
            <p class="text-sm text-green-600">
                ðŸŽ‰ No outstanding levies.
            </p>
        {% endif %}
    </div>

    {% endif %}

</div>
{% endblock %}

